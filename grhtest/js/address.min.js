$(document).ready(function(){var area1=new LArea();area1.init({'trigger':'#person_area','valueTo':'#value1','keys':{id:'code',name:'name'},'type':1,'data':LAreaData });area1.value=[0,0,0];if(sessionStorage.addressData){var addressData=sessionStorage.addressData;addressData=JSON.parse(addressData);addressData=JSON.parse(addressData);$("#person_name").val(addressData.consignee);$("#person_phone").val(addressData.mobile);$("#person_area").val(addressData.provinceName+","+addressData.cityName+","+addressData.countyName);$("#value1").val(addressData.province+","+addressData.city+","+addressData.county);$("#person_moreAddress").val(addressData.street);$("#btn_save").attr("dataid",addressData.id)};$('.person_message input[type=text]').on("blur",function(){});$('#btn_save').on('click',function(){var addrId;var userId=common.user_data().cuserInfoid;var source="userId"+userId;var sign=md5(source+"key"+common.secretKey()).toUpperCase();var consignee=$("#person_name").val();var mobile=$("#person_phone").val();var Area=$('#person_area').val();var AreaCode=$("#value1").val();var street=$("#person_moreAddress").val();var arr1=[],arr2=[];arr1=Area.split(",");arr2=AreaCode.split(",");var provinceName=arr1[0];var province=arr2[0];var cityName=arr1[1];var city=arr2[1];var countyName=arr1[2];var county=arr2[2];if(consignee==''){common.prompt("请输入用户名")}else if(mobile==''||!common.phoneNumberReg.test(mobile)){common.prompt("请输入正确的手机号")}else if(Area==''){common.prompt("请选择城市")}else if(street==''){common.prompt("请输入详细地址")}else{if(sessionStorage.addressData){addrId=$(this).attr("dataid");changeAddress(userId,addrId,consignee,mobile,province,provinceName,city,cityName,county,countyName,street,sign,source)}else{addAddress(userId,consignee,mobile,province,provinceName,city,cityName,county,countyName,street,sign,source)}}});function addAddress(userId,consignee,mobile,province,provinceName,city,cityName,county,countyName,street,sign,source){$.ajax({url:common.http,type:'post',dataType:"jsonp",data:{method:'address_add',userId:userId,consignee:consignee,mobile:mobile,province:province,provinceName:provinceName,city:city,cityName:cityName,county:county,countyName:countyName,street:street,tokenId:common.tokenId(),sign:sign,source:source},success:function(data){if(data.statusCode=='100000'){window.history.back()}else{common.prompt(data.statusStr)}},error:function(data){common.prompt(data.statusStr)}})};function changeAddress(userId,addrId,consignee,mobile,province,provinceName,city,cityName,county,countyName,street,sign,source){$.ajax({url:common.http,type:'post',dataType:"jsonp",data:{method:'address_update',userId:userId,addrId:addrId,consignee:consignee,mobile:mobile,province:province,provinceName:provinceName,city:city,cityName:cityName,county:county,countyName:countyName,street:street,tokenId:common.tokenId(),sign:sign,source:source},success:function(data){if(data.statusCode=='100000'){window.history.back();sessionStorage.removeItem("addressData")}else{common.prompt(data.statusStr)}},error:function(data){common.prompt(data.statusStr)}})};$('.header_left').on('click',function(){window.history.back();sessionStorage.removeItem("addressData")})});
$(document).ready(function(){var petName;var realName;var idCard;var sex;var userId=common.user_data().cuserInfoid;var source="userId"+userId;var sign=md5(source+"key"+common.secretKey()).toUpperCase();$('.header_left').on('click',function(){localStorage.removeItem('change_style');window.location.href='my.html'});if(!localStorage.getItem('change_style')){message_show(userId,sign,source)}else{$('#message_nick').val(JSON.parse(localStorage.getItem('change_style')).petName);$('#message_name').val(JSON.parse(localStorage.getItem('change_style')).realName);$('#message_IDcard').val(JSON.parse(localStorage.getItem('change_style')).idCard);$('#message_sex').val(JSON.parse(localStorage.getItem('change_style')).sex);$('#message_phoneNumber').val(JSON.parse(localStorage.getItem('change_style')).phone)};$('#message_IDcard').on('click',function(){if($('#message_IDcard').val()==''||!common.regIdCard.test(idCard)){$('#message_IDcard').removeAttr('disabled')}else{$('#message_IDcard').attr("disabled","disabled")}});$('.main_reverse').on('click',function(){petName=$('#message_nick').val();realName=$('#message_name').val();idCard=$('#message_IDcard').val();sex=$('#message_sex').val();if(sex=='男'){sex=1}else{sex=2};var mobile=$('#message_phoneNumber').val();source="idCard"+idCard+"-userId"+userId;sign=md5(source+"key"+common.secretKey()).toUpperCase();if(petName==''){var str='请输入昵称';common.prompt(str)}else if(realName==''){var str='请输入真实姓名';common.prompt(str)}else if(idCard==''){var str='请填写身份证号';common.prompt(str)}else if(!common.regIdCard.test(idCard)){var str='身份证号格式不正确';common.prompt(str)}else{messageChange(userId,petName,realName,idCard,sex,sign,source);localStorage.removeItem('change_style')}});$('.message_sex').on('click',function(){if($('.message_sex_choose').css("display")=="none"){$('.message_sex_choose').css({'display':'block'});$('.message_sex').animate({'height':'261px'},500)}else{$('.message_sex').animate({'height':'87px'},500,function(){$('.message_sex_choose').css({'display':'none'})})}});$('.message_sex_choose li').on('click',function(){var tab=$('.message_sex_choose li').index(this);if(tab==0){$('#message_sex').val('男')}else if(tab==1){$('#message_sex').val('女')}});$('.message_phoneNumber').on('click',function(){var petName=$('#message_nick').val();var realName=$('#message_name').val();var idCard=$('#message_IDcard').val();var sex=$('#message_sex').val();var mobile=$('#message_phoneNumber').val();var change_style={petName:petName,realName:realName,idCard:idCard,sex:sex,phone:mobile};localStorage.setItem('change_style',JSON.stringify(change_style));window.location.href='phoneChange.html'});function message_show(userId,sign,source){$.ajax({url:common.http,dataType:'jsonp',data:{method:'show',userId:userId,tokenId:common.tokenId(),sign:sign,source:source},success:function(data){if(data.statusCode=="100000"){message_person(data)}},error:function(data){common.prompt(data.statusStr)}})};function message_person(data){$('#message_nick').val(data.data.petName);$('#message_name').val(data.data.realName);$('#message_IDcard').val(data.data.idcard);$('#message_IDcard').css({'color':'#b2b2b2'});if(data.data.idcard==''){$('#message_IDcard').removeAttr("disabled")}if(data.data.sex==1){$('#message_sex').val('男')}else if(data.data.sex==2){$('#message_sex').val('女')}$('#message_phoneNumber').val(data.data.mobile)};function messageChange(userId,petName,realName,idCard,sex,sign,source){$.ajax({url:common.http,dataType:'jsonp',data:{method:'update_userinfo',userId:userId,petName:petName,realName:realName,idCard:idCard,sex:sex,tokenId:common.tokenId(),sign:sign,source:source},success:function(data){if(data.statusCode=="100000"){success_reverse(data);var user_data={cuserInfoid:common.user_data().cuserInfoid,firmId:common.user_data().firmId,faceImg:common.user_data().faceImg,petName:petName,realName:realName,idCard:idCard,mobile:common.user_data().mobile,sex:sex};localStorage.setItem("user_data",JSON.stringify(user_data))}},error:function(data){common.prompt(data.statusStr)}})};function success_reverse(data){$('.pop').css({'display':'block'});$('.pop_makeSure').on('click',function(){setTimeout(function(){window.location.href='my.html'},500)})}});